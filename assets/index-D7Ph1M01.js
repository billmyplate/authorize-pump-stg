var e=Object.defineProperty,__publicField=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t=(e=>(e.INITIAL="initial",e.STORES_PAGE="stores-page",e.REGISTER_FORM="register-form",e.REGISTER_EXTENDED_FORM="register-extended-form",e.IN_OTP_FORM="otp-form",e.FINAL="final",e.ERROR="error",e))(t||{});class ApiService{constructor(){__publicField(this,"API_BASE_URL","https://stg-bmp-api.billmyplate.com")}async fetchConfirmationData(e,t){try{if(!e||!t)throw new Error("Invalid merchantId or pumpNumber");const n=await fetch(`${this.API_BASE_URL}/event/plate-detection/latest?merchantId=${e}&pumpNumber=${t}`);if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);return await n.json()}catch(n){throw n}}async registerCustomer(e,t,n){if(!e||!t)throw new Error("Missing phone or creditCard");try{const r=await fetch(`${this.API_BASE_URL}/customer/${n?"register-full":"register"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e,creditCard:t,...n||{}})});if(!r.ok)throw new Error(`Request failed: ${r.statusText}`);return await r.json()}catch(r){throw r}}async verifySmsToken(e,t,n){try{if(!e||!t)throw new Error("Missing id or token");const{position:r,...i}=n||{},s=await fetch(`${this.API_BASE_URL}/customer/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,token:t,...n?{pumpData:{...i,...r}}:{}})});if(!s.ok)throw new Error(`Request failed: ${s.statusText}`);return await s.json()}catch(r){throw r}}async listStores(e){try{const t=await fetch(`${this.API_BASE_URL}/customer/stores?longitude=${e.longitude}&latitude=${e.latitude}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await t.json()}catch(t){throw t}}}class BaseComponent{constructor(e){__publicField(this,"store"),__publicField(this,"state"),__publicField(this,"apiService",new ApiService),__publicField(this,"templates",Object.assign({"./canceled/canceled.template.html":'<section class="container">\n  <div class="col-container">\n    <h1 class="heading" id="main-heading">{message}</h1>\n\n    <button\n      id="closeBtn"\n      class="btn btn-primary"\n      aria-label="Close the form"\n      aria-labelledby="main-heading"\n    >\n      <span>Close</span>\n    </button>\n  </div>\n</section>\n',"./initial/initial.template.html":'<div class="container">\n  <div class="relative w-12 h-12">\n    <div\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-t-sunflower-yellow animate-spin"\n    >\n    \n  </div>\n    <div\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-b-navy-blue animate-[spin_1.5s_linear_reverse_infinite]"\n    ></div>\n  </div>\n</div>\n'})),this.store=e,this.state=e.getState()}handleDomAccessError(e){this.store.transitionTo(this.state.state)}$(e){const t=document.querySelector(e);return t||this.handleDomAccessError(e),t}$_all(e){const t=document.querySelectorAll(e);return 0===t.length&&this.handleDomAccessError(e),t}buildTemplatePath(){const e=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace("-component","");return`./${e}/${e}.template.html`}processTemplate(e,t){return e.replace(/\{([^{}]+)\}/g,((e,n)=>n.trim()in t?t[n.trim()]:""))}templateData(){return{}}render(){const e=this.buildTemplatePath();if(e in this.templates)try{const t=this.templates[e];return this.processTemplate(t,this.templateData())}catch(t){this.store.transitionTo(this.state.state)}return""}preventNonNumericValues(e,t){t.forEach((t=>{const n=e.querySelector(t);n.addEventListener("input",(()=>{n.value=n.value.replace(/\D/g,"")}))}))}attachEvents(){}}class InitialComponent extends BaseComponent{}var n,r={exports:{}};var i=(n||(n=1,function(e,t,n){var validate2=function(e,t,n){n=r.extend({},r.options,n);var i=r.runValidations(e,t,n);if(i.some((function(e){return r.isPromise(e.error)})))throw new Error("Use validate.async if you want support for promises");return validate2.processValidationResults(i,n)},r=validate2;r.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){for(var n in t)e[n]=t[n]})),e},r.extend(validate2,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var e=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(e+="+"+r.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,n){var i,s,o,a,l,u,c,d=[];for(i in(r.isDomElement(e)||r.isJqueryElement(e))&&(e=r.collectFormValues(e)),t)for(s in o=r.getDeepObjectValue(e,i),a=r.result(t[i],o,e,i,n,t)){if(!(l=r.validators[s]))throw c=r.format("Unknown validator %{name}",{name:s}),new Error(c);u=a[s],(u=r.result(u,o,e,i,n,t))&&d.push({attribute:i,value:o,validator:s,globalOptions:n,attributes:e,options:u,error:l.call(l,o,u,i,e,n)})}return d},processValidationResults:function(e,t){e=r.pruneEmptyErrors(e,t),e=r.expandMultipleErrors(e,t),e=r.convertErrorMessages(e,t);var n=t.format||"grouped";if("function"!=typeof r.formatters[n])throw new Error(r.format("Unknown format %{format}",t));return e=r.formatters[n](e),r.isEmpty(e)?void 0:e},async:function(e,t,n){var i=(n=r.extend({},r.async.options,n)).wrapErrors||function(e){return e};!1!==n.cleanAttributes&&(e=r.cleanAttributes(e,t));var s=r.runValidations(e,t,n);return new r.Promise((function(o,a){r.waitForResults(s).then((function(){var l=r.processValidationResults(s,n);l?a(new i(l,n,e,t)):o(e)}),(function(e){a(e)}))}))},single:function(e,t,n){return n=r.extend({},r.single.options,n,{format:"flat",fullMessages:!1}),r({single:e},{single:t},n)},waitForResults:function(e){return e.reduce((function(e,t){return r.isPromise(t.error)?e.then((function(){return t.error.then((function(e){t.error=e||null}))})):e}),new r.Promise((function(e){e()})))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return r.isNumber(e)&&e%1==0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!=e},isPromise:function(e){return!!e&&r.isFunction(e.then)},isJqueryElement:function(e){return e&&r.isString(e.jquery)},isDomElement:function(e){return!!e&&!(!e.querySelectorAll||!e.querySelector)&&(!(!r.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName))},isEmpty:function(e){var t;if(!r.isDefined(e))return!0;if(r.isFunction(e))return!1;if(r.isString(e))return r.EMPTY_STRING_REGEXP.test(e);if(r.isArray(e))return 0===e.length;if(r.isDate(e))return!1;if(r.isObject(e)){for(t in e)return!1;return!0}return!1},format:r.extend((function(e,t){return r.isString(e)?e.replace(r.format.FORMAT_REGEXP,(function(e,n,r){return"%"===n?"%{"+r+"}":String(t[r])})):e}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return r.isNumber(e)?100*e%1==0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):r.isArray(e)?e.map((function(e){return r.prettify(e)})).join(", "):r.isObject(e)?r.isDefined(e.toString)?e.toString():JSON.stringify(e):(e=""+e).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(e,t,n){return t+" "+n.toLowerCase()})).toLowerCase()},stringifyValue:function(e,t){return(t&&t.prettify||r.prettify)(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return r.isObject(e)&&!r.isArray(e)&&!r.isFunction(e)},contains:function(e,t){return!!r.isDefined(e)&&(r.isArray(e)?-1!==e.indexOf(t):t in e)},unique:function(e){return r.isArray(e)?e.filter((function(e,t,n){return n.indexOf(e)==t})):e},forEachKeyInKeypath:function(e,t,n){if(r.isString(t)){var i,s="",o=!1;for(i=0;i<t.length;++i)switch(t[i]){case".":o?(o=!1,s+="."):(e=n(e,s,!1),s="");break;case"\\":o?(o=!1,s+="\\"):o=!0;break;default:o=!1,s+=t[i]}return n(e,s,!0)}},getDeepObjectValue:function(e,t){if(r.isObject(e))return r.forEachKeyInKeypath(e,t,(function(e,t){if(r.isObject(e))return e[t]}))},collectFormValues:function(e,t){var n,i,s,o,a,l,u={};if(r.isJqueryElement(e)&&(e=e[0]),!e)return u;for(t=t||{},o=e.querySelectorAll("input[name], textarea[name]"),n=0;n<o.length;++n)if(s=o.item(n),!r.isDefined(s.getAttribute("data-ignored"))){var c=s.name.replace(/\./g,"\\\\.");l=r.sanitizeFormValue(s.value,t),"number"===s.type?l=l?+l:null:"checkbox"===s.type?s.attributes.value?s.checked||(l=u[c]||null):l=s.checked:"radio"===s.type&&(s.checked||(l=u[c]||null)),u[c]=l}for(o=e.querySelectorAll("select[name]"),n=0;n<o.length;++n)if(s=o.item(n),!r.isDefined(s.getAttribute("data-ignored"))){if(s.multiple)for(i in l=[],s.options)(a=s.options[i])&&a.selected&&l.push(r.sanitizeFormValue(a.value,t));else{var d=void 0!==s.options[s.selectedIndex]?s.options[s.selectedIndex].value:"";l=r.sanitizeFormValue(d,t)}u[s.name]=l}return u},sanitizeFormValue:function(e,t){return t.trim&&r.isString(e)&&(e=e.trim()),!1!==t.nullify&&""===e?null:e},capitalize:function(e){return r.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter((function(e){return!r.isEmpty(e.error)}))},expandMultipleErrors:function(e){var t=[];return e.forEach((function(e){r.isArray(e.error)?e.error.forEach((function(n){t.push(r.extend({},e,{error:n}))})):t.push(e)})),t},convertErrorMessages:function(e,t){var n=[],i=(t=t||{}).prettify||r.prettify;return e.forEach((function(e){var s=r.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);r.isString(s)?("^"===s[0]?s=s.slice(1):!1!==t.fullMessages&&(s=r.capitalize(i(e.attribute))+" "+s),s=s.replace(/\\\^/g,"^"),s=r.format(s,{value:r.stringifyValue(e.value,t)}),n.push(r.extend({},e,{error:s}))):n.push(e)})),n},groupErrorsByAttribute:function(e){var t={};return e.forEach((function(e){var n=t[e.attribute];n?n.push(e):t[e.attribute]=[e]})),t},flattenErrorsToArray:function(e){return e.map((function(e){return e.error})).filter((function(e,t,n){return n.indexOf(e)===t}))},cleanAttributes:function(e,t){function whitelistCreator(e,t,n){return r.isObject(e[t])?e[t]:e[t]=!!n||{}}return r.isObject(t)&&r.isObject(e)?function cleanRecursive(e,t){if(!r.isObject(e))return e;var n,i,s=r.extend({},e);for(i in e)n=t[i],r.isObject(n)?s[i]=cleanRecursive(s[i],n):n||delete s[i];return s}(e,t=function(e){var t,n={};for(t in e)e[t]&&r.forEachKeyInKeypath(n,t,whitelistCreator);return n}(t)):{}},exposeModule:function(e,t,n,r,i){n?(r&&r.exports&&(n=r.exports=e),n.validate=e):(t.validate=e,e.isFunction(i)&&i.amd&&i([],(function(){return e})))},warn:function(e){"undefined"!=typeof console&&console.warn},error:function(e){"undefined"!=typeof console&&console.error}}),validate2.validators={presence:function(e,t){if(!1!==(t=r.extend({},this.options,t)).allowEmpty?!r.isDefined(e):r.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,n){if(r.isDefined(e)){var i,s=(t=r.extend({},this.options,t)).is,o=t.maximum,a=t.minimum,l=[],u=(e=(t.tokenizer||function(e){return e})(e)).length;return r.isNumber(u)?(r.isNumber(s)&&u!==s&&(i=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",l.push(r.format(i,{count:s}))),r.isNumber(a)&&u<a&&(i=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",l.push(r.format(i,{count:a}))),r.isNumber(o)&&u>o&&(i=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",l.push(r.format(i,{count:o}))),l.length>0?t.message||l:void 0):t.message||this.notValid||"has an incorrect length"}},numericality:function(e,t,n,i,s){if(r.isDefined(e)){var o,a,l=[],u={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t==0}},c=(t=r.extend({},this.options,t)).prettify||s&&s.prettify||r.prettify;if(r.isString(e)&&t.strict){var d="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(d+="(\\.\\d+)?"),d+="$",!new RegExp(d).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==t.noStrings&&r.isString(e)&&!r.isEmpty(e)&&(e=+e),!r.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!r.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(o in u)if(a=t[o],r.isNumber(a)&&!u[o](e,a)){var p="not"+r.capitalize(o),m=t[p]||this[p]||this.message||"must be %{type} %{count}";l.push(r.format(m,{count:a,type:c(o)}))}return t.odd&&e%2!=1&&l.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!=0&&l.push(t.notEven||this.notEven||this.message||"must be even"),l.length?t.message||l:void 0}},datetime:r.extend((function(e,t){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(e)){var n,i=[],s=(t=r.extend({},this.options,t)).earliest?this.parse(t.earliest,t):NaN,o=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!=0?(n=t.notValid||t.message||this.notValid||"must be a valid date",r.format(n,{value:arguments[0]})):(!isNaN(s)&&e<s&&(n=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",n=r.format(n,{value:this.format(e,t),date:this.format(s,t)}),i.push(n)),!isNaN(o)&&e>o&&(n=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",n=r.format(n,{date:this.format(o,t),value:this.format(e,t)}),i.push(n)),i.length?r.unique(i):void 0)}}),{parse:null,format:null}),date:function(e,t){return t=r.extend({},t,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,e,t)},format:function(e,t){(r.isString(t)||t instanceof RegExp)&&(t={pattern:t});var n,i=(t=r.extend({},this.options,t)).message||this.message||"is invalid",s=t.pattern;if(r.isDefined(e))return r.isString(e)?(r.isString(s)&&(s=new RegExp(t.pattern,t.flags)),(n=s.exec(e))&&n[0].length==e.length?void 0:i):i},inclusion:function(e,t){if(r.isDefined(e)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),!r.contains(t.within,e))){var n=t.message||this.message||"^%{value} is not included in the list";return r.format(n,{value:e})}},exclusion:function(e,t){if(r.isDefined(e)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),r.contains(t.within,e))){var n=t.message||this.message||"^%{value} is restricted";return r.isString(t.within[e])&&(e=t.within[e]),r.format(n,{value:e})}},email:r.extend((function(e,t){var n=(t=r.extend({},this.options,t)).message||this.message||"is not a valid email";if(r.isDefined(e))return r.isString(e)&&this.PATTERN.exec(e)?void 0:n}),{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(e,t,n,i,s){if(r.isDefined(e)){r.isString(t)&&(t={attribute:t});var o=(t=r.extend({},this.options,t)).message||this.message||"is not equal to %{attribute}";if(r.isEmpty(t.attribute)||!r.isString(t.attribute))throw new Error("The attribute must be a non empty string");var a=r.getDeepObjectValue(i,t.attribute),l=t.comparator||function(e,t){return e===t},u=t.prettify||s&&s.prettify||r.prettify;return l(e,a,t,n,i)?void 0:r.format(o,{attribute:u(t.attribute)})}},url:function(e,t){if(r.isDefined(e)){var n=(t=r.extend({},this.options,t)).message||this.message||"is not a valid url",i=t.schemes||this.schemes||["http","https"],s=t.allowLocal||this.allowLocal||!1,o=t.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(e))return n;var a="^(?:(?:"+i.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return s?l+="?":a+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",a+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o&&(a="(?:"+a+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(a,"i").exec(e)?void 0:n}},type:r.extend((function(e,t,n,i,s){if(r.isString(t)&&(t={type:t}),r.isDefined(e)){var o,a=r.extend({},this.options,t),l=a.type;if(!r.isDefined(l))throw new Error("No type was specified");if(o=r.isFunction(l)?l:this.types[l],!r.isFunction(o))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!o(e,a,n,i,s)){var u=t.message||this.messages[l]||this.message||a.message||(r.isFunction(l)?"must be of the correct type":"must be of type %{type}");return r.isFunction(u)&&(u=u(e,t,n,i,s)),r.format(u,{attribute:r.prettify(n),type:l})}}}),{types:{object:function(e){return r.isObject(e)&&!r.isArray(e)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},validate2.formatters={detailed:function(e){return e},flat:r.flattenErrorsToArray,grouped:function(e){var t;for(t in e=r.groupErrorsByAttribute(e))e[t]=r.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;for(t in e=r.groupErrorsByAttribute(e))e[t]=e[t].map((function(e){return e.validator})).sort();return e}},validate2.exposeModule(validate2,this,e,t,n)}.call(r.exports,r.exports,r,null)),r.exports);class AppBaseComponent extends BaseComponent{constructor(e){super(e),this.templates=Object.assign({"./final/final.template.html":'<div class="container">\n  <div class="col-container">\n    <img\n      role="img"\n      class="w-full h-64 md:h-80 object-cover rounded-lg"\n      src="pump.svg"\n      alt="Illustration of a gas pump"\n      aria-describedby="pump-instructions"\n    />\n\n    <h1 id="pump-instructions" class="heading">\n      Pump authorized successfully \n    </h1>\n  </div>\n</div>\n',"./otp-form/otp-form.template.html":'<div class="container">\n  <div\n    class="form col-container border border-gray-200 shadow-sm justify-between"\n  >\n    <div class="col-container">\n      <div class="font-semibold text-3xl">\n        <p>Phone Verification</p>\n      </div>\n      <div class="flex flex-row text-sm font-medium text-gray-400">\n        <p>We have sent a code to your phone number</p>\n      </div>\n    </div>\n\n    <form class="form">\n      <div\n        class="flex flex-row items-center justify-between mx-auto w-full gap-1 my-5"\n      >\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n      </div>\n\n      <button class="btn btn-primary w-full">Verify</button>\n    </form>\n    <span id="error" class="error mx-auto" role="alert"></span>\n  </div>\n</div>\n',"./register-extended-form/register-extended-form.template.html":'<section class="container">\n    <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\n      <div class="mx-auto max-w-5xl">\n        <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\n          <form class="form bordered-form" aria-labelledby="credit-card-form">\n            <h2 id="credit-card-form" class="sr-only">Register to authorize pump</h2>\n\n            \x3c!-- New Fields --\x3e\n            <div class="mb-6 grid grid-cols-2 gap-4">\n              \x3c!-- First Name --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label for="first-name" class="mb-2 block text-sm font-medium">First Name*</label>\n                <input\n                  type="text"\n                  id="first-name"\n                  class="form-input"\n                  placeholder="John"\n                  aria-required="true"\n                />\n              </div>\n\n              \x3c!-- Last Name --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label for="last-name" class="mb-2 block text-sm font-medium">Last Name*</label>\n                <input\n                  type="text"\n                  id="last-name"\n                  class="form-input"\n                  placeholder="Doe"\n                  aria-required="true"\n                />\n              </div>\n\n              \x3c!-- Email --\x3e\n              <div class="col-span-2">\n                <label for="email" class="mb-2 block text-sm font-medium">Email*</label>\n                <input\n                  type="email"\n                  id="email"\n                  class="form-input"\n                  placeholder="example@example.com"\n                  aria-required="true"\n                />\n              </div>\n\n              \x3c!-- Password --\x3e\n              <div class="col-span-2">\n                <label for="password" class="mb-2 block text-sm font-medium">Password*</label>\n                <input\n                  type="password"\n                  id="password"\n                  class="form-input"\n                  placeholder="••••••••"\n                  aria-required="true"\n                />\n              </div>\n\n              \x3c!-- Pin Code --\x3e\n              <div class="col-span-2">\n                <label for="pin-code" class="mb-2 block text-sm font-medium">Pin Code*</label>\n                <input\n                  type="password"\n                  id="pin-code"\n                  class="form-input"\n                  maxlength="4"\n                  placeholder="1234"\n                  aria-required="true"\n                />\n              </div>\n            </div>\n\n\n            <div class="mb-6 grid grid-cols-1 gap-4">\n              \x3c!-- Mobile Phone Input --\x3e\n              <div class="col-span-1">\n                <label\n                  for="mobile-phone-input"\n                  class="mb-2 block text-sm font-medium"\n                  >Mobile Phone*</label\n                >\n                <input\n                  type="tel"\n                  id="mobile-phone-input"\n                  class="form-input"\n                  inputmode="tel"\n                  placeholder="(123) 456-7890"\n                  aria-required="true"\n                  aria-describedby="mobile-phone-description"\n                />\n                <span id="mobile-phone-description" class="sr-only">\n                  Enter your 10-digit mobile phone number.\n                </span>\n              </div>\n            </div>\n\n            \n          <div class="mb-6 grid grid-cols-1 gap-4">\n            \x3c!-- Pump Number Dropdown --\x3e\n            <div class="col-span-1">\n              <label for="pump-number" class="mb-2 block text-sm font-medium text-gray-700">\n                Pump Number*\n              </label>\n              <select\n                id="pump-number"\n                class="form-select w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50 hover:border-gray-400"\n                aria-required="true"\n                aria-describedby="pump-number-description"\n              >\n                \x3c!-- Options will be dynamically populated --\x3e\n              </select>\n              <span id="pump-number-description" class="sr-only">\n                Select the pump number you want to authorize.\n              </span>\n            </div>\n          </div>\n\n            <div class="mb-6 grid grid-cols-2 gap-4">\n              \x3c!-- Card Number Input --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label\n                  for="card-number-input"\n                  class="mb-2 block text-sm font-medium"\n                  >Card number*</label\n                >\n                <input\n                  type="text"\n                  class="form-input"\n                  aria-required="true"\n                  inputmode="numeric"\n                  id="card-number-input"\n                  placeholder="xxxx-xxxx-xxxx-xxxx"\n                  aria-describedby="card-number-description"\n                />\n                <span id="card-number-description" class="sr-only">\n                  Enter your 16-digit card number without spaces or dashes.\n                </span>\n              </div>\n\n              \x3c!-- Zipcode Input --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label for="zipcode" class="mb-2 block text-sm font-medium"\n                  >Zipcode*</label\n                >\n                <input\n                  type="text"\n                  id="zipcode"\n                  maxlength="5"\n                  class="form-input"\n                  inputmode="numeric"\n                  placeholder="12345"\n                  aria-required="true"\n                  aria-describedby="zipcode-description"\n                />\n                <span id="zipcode-description" class="sr-only">\n                  Enter a 5-digit ZIP code.\n                </span>\n              </div>\n\n              \x3c!-- Card Expiration Input --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label\n                  for="card-expiration-input"\n                  class="mb-2 block text-sm font-medium"\n                  >Card expiration*</label\n                >\n                <div class="relative">\n                  <input\n                    type="text"\n                    class="form-input"\n                    placeholder="MM/YY"\n                    inputmode="numeric"\n                    aria-required="true"\n                    id="card-expiration-input"\n                    aria-describedby="card-expiration-description"\n                  />\n                  <span id="card-expiration-description" class="sr-only">\n                    Enter the expiration date in MM/YY format.\n                  </span>\n                </div>\n              </div>\n\n              \x3c!-- CVV Input with Tooltip --\x3e\n              <div class="col-span-2 sm:col-span-1">\n                <label for="cvv-input" class="mb-2 block text-sm font-medium">\n                  CVV*\n                  <button\n                    type="button"\n                    class="relative group"\n                    aria-label="CVV information"\n                  >\n                    <svg\n                      aria-hidden="true"\n                      fill="currentColor"\n                      viewBox="0 0 24 24"\n                      xmlns="http://www.w3.org/2000/svg"\n                      class="h-4 w-4 text-gray-400 hover:text-navy-blue"\n                    >\n                      <path\n                        fill-rule="evenodd"\n                        clip-rule="evenodd"\n                        d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.408-5.5a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4a1 1 0 0 0-1-1h-2Z"\n                      />\n                    </svg>\n                    <span\n                      role="tooltip"\n                      aria-hidden="true"\n                      class="absolute left-1/2 top-full mt-1 hidden w-max -translate-x-1/2 rounded-lg bg-navy-blue px-3 py-2 text-sm font-medium text-white shadow-md group-hover:block"\n                    >\n                      The last 3-4 digits on the back of the card\n                    </span>\n                  </button>\n                </label>\n                <input\n                  type="text"\n                  id="cvv-input"\n                  maxlength="4"\n                  placeholder="•••"\n                  class="form-input"\n                  inputmode="numeric"\n                  aria-required="true"\n                  aria-describedby="cvv-description"\n                />\n                <span id="cvv-description" class="sr-only">\n                  Enter the 3-digit security code found on the back of your card.\n                </span>\n              </div>\n            </div>\n\n            \x3c!-- Submit Button --\x3e\n            <button\n              type="submit"\n              aria-label="Register"\n              class="btn btn-primary w-full"\n            >\n              Submit\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n\n    <span id="error" class="error" role="alert"></span>\n  </section>',"./register-form/register-form.template.html":'<section class="container">\n  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\n    <div class="mx-auto max-w-5xl">\n      <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\n        <form class="form bordered-form" aria-labelledby="credit-card-form">\n          <h2 id="credit-card-form" class="sr-only">Register to authorize pump</h2>\n\n          <div class="mb-6 grid grid-cols-1 gap-4">\n            \x3c!-- Mobile Phone Input --\x3e\n            <div class="col-span-1">\n              <label\n                for="mobile-phone-input"\n                class="mb-2 block text-sm font-medium"\n                >Mobile Phone*</label\n              >\n              <input\n                type="tel"\n                id="mobile-phone-input"\n                class="form-input"\n                inputmode="tel"\n                placeholder="(123) 456-7890"\n                aria-required="true"\n                aria-describedby="mobile-phone-description"\n              />\n              <span id="mobile-phone-description" class="sr-only">\n                Enter your 10-digit mobile phone number.\n              </span>\n            </div>\n          </div>\n\n          <div class="mb-6 grid grid-cols-1 gap-4">\n            \x3c!-- Pump Number Dropdown --\x3e\n            <div class="col-span-1">\n              <label for="pump-number" class="mb-2 block text-sm font-medium text-gray-700">\n                Pump Number*\n              </label>\n              <select\n                id="pump-number"\n                class="form-select w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50 hover:border-gray-400"\n                aria-required="true"\n                aria-describedby="pump-number-description"\n              >\n                \x3c!-- Options will be dynamically populated --\x3e\n              </select>\n              <span id="pump-number-description" class="sr-only">\n                Select the pump number you want to authorize.\n              </span>\n            </div>\n          </div>\n\n          <div class="mb-6 grid grid-cols-2 gap-4">\n            \x3c!-- Card Number Input --\x3e\n            <div class="col-span-2 sm:col-span-1">\n              <label\n                for="card-number-input"\n                class="mb-2 block text-sm font-medium"\n                >Card number*</label\n              >\n              <input\n                type="text"\n                class="form-input"\n                aria-required="true"\n                inputmode="numeric"\n                id="card-number-input"\n                placeholder="xxxx-xxxx-xxxx-xxxx"\n                aria-describedby="card-number-description"\n              />\n              <span id="card-number-description" class="sr-only">\n                Enter your 16-digit card number without spaces or dashes.\n              </span>\n            </div>\n\n            \x3c!-- Zipcode Input --\x3e\n            <div class="col-span-2 sm:col-span-1">\n              <label for="zipcode" class="mb-2 block text-sm font-medium"\n                >Zipcode*</label\n              >\n              <input\n                type="text"\n                id="zipcode"\n                maxlength="5"\n                class="form-input"\n                inputmode="numeric"\n                placeholder="12345"\n                aria-required="true"\n                aria-describedby="zipcode-description"\n              />\n              <span id="zipcode-description" class="sr-only">\n                Enter a 5-digit ZIP code.\n              </span>\n            </div>\n\n            \x3c!-- Card Expiration Input --\x3e\n            <div class="col-span-2 sm:col-span-1">\n              <label\n                for="card-expiration-input"\n                class="mb-2 block text-sm font-medium"\n                >Card expiration*</label\n              >\n              <div class="relative">\n                <input\n                  type="text"\n                  class="form-input"\n                  placeholder="MM/YY"\n                  inputmode="numeric"\n                  aria-required="true"\n                  id="card-expiration-input"\n                  aria-describedby="card-expiration-description"\n                />\n                <span id="card-expiration-description" class="sr-only">\n                  Enter the expiration date in MM/YY format.\n                </span>\n              </div>\n            </div>\n\n            \x3c!-- CVV Input with Tooltip --\x3e\n            <div class="col-span-2 sm:col-span-1">\n              <label for="cvv-input" class="mb-2 block text-sm font-medium">\n                CVV*\n                <button\n                  type="button"\n                  class="relative group"\n                  aria-label="CVV information"\n                >\n                  <svg\n                    aria-hidden="true"\n                    fill="currentColor"\n                    viewBox="0 0 24 24"\n                    xmlns="http://www.w3.org/2000/svg"\n                    class="h-4 w-4 text-gray-400 hover:text-navy-blue"\n                  >\n                    <path\n                      fill-rule="evenodd"\n                      clip-rule="evenodd"\n                      d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.408-5.5a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4a1 1 0 0 0-1-1h-2Z"\n                    />\n                  </svg>\n                  <span\n                    role="tooltip"\n                    aria-hidden="true"\n                    class="absolute left-1/2 top-full mt-1 hidden w-max -translate-x-1/2 rounded-lg bg-navy-blue px-3 py-2 text-sm font-medium text-white shadow-md group-hover:block"\n                  >\n                    The last 3-4 digits on the back of the card\n                  </span>\n                </button>\n              </label>\n              <input\n                type="text"\n                id="cvv-input"\n                maxlength="4"\n                placeholder="•••"\n                class="form-input"\n                inputmode="numeric"\n                aria-required="true"\n                aria-describedby="cvv-description"\n              />\n              <span id="cvv-description" class="sr-only">\n                Enter the 3-digit security code found on the back of your card.\n              </span>\n            </div>\n          </div>\n\n          \x3c!-- Submit Button --\x3e\n          <button\n            type="submit"\n            aria-label="Register"\n            class="btn btn-primary w-full"\n          >\n            Submit\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <span id="error" class="error" role="alert"></span>\n</section>',"./store-card/store-card.template.html":'<div class="mx-auto max-w-screen-xl px-4 2xl:px-0 transition-transform duration-300 hover:scale-105 hover:shadow-lg cursor-pointer" id="id-{storeId}">\n  <div class="mx-auto max-w-5xl">\n    <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\n      <div class="border p-6 rounded-lg shadow-md w-full">\n        <h2 class="text-lg font-semibold mb-4 text-navy-blue">\n          Store Details\n        </h2>\n\n        <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 gap-4">\n          <div>\n            <p class="text-sm font-medium text-gray-600">Store Name</p>\n            <p class="text-base font-semibold text-gray-900">{storeName}</p>\n          </div>\n          \x3c!-- <div>\n            <p class="text-sm font-medium text-gray-600">Store ID</p>\n            <p class="text-base font-semibold text-gray-900">{storeId}</p>\n          </div> --\x3e\n          <div>\n            <p class="text-sm font-medium text-gray-600">Store Number</p>\n            <p class="text-base font-semibold text-gray-900">{storeNumber}</p>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-600">Fuel Brand</p>\n            <p class="text-base font-semibold text-gray-900">{fuelBrand}</p>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-600">Phone</p>\n            <p class="text-base font-semibold text-gray-900">{phone}</p>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-600">Number of Pumps</p>\n            <p class="text-base font-semibold text-gray-900">{numberOfPumps}</p>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-600">Online Status</p>\n            <p class="text-base font-semibold text-green-600">\n              {isOnline}\n            </p>\n          </div>\n        </div>\n\n        <div class="mt-4 border-t pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">\n          <div>\n            <p class="text-sm font-medium text-gray-600">Address</p>\n            <p class="text-base font-semibold text-gray-900">\n              {streetAddress}, {city}, {stateCode}\n            </p>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-600">Geo Location</p>\n            <p class="text-base font-semibold text-gray-900">\n              Lat: {latitude}, Long: {longitude}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n',"./stores/stores.template.html":'<section class="container py-8">\n  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\n    <h1 class="text-2xl font-bold mb-6 text-navy-blue">Available Stores</h1>\n\n    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">\n      \x3c!-- Loop through stores and render store-card --\x3e\n     \n        {stores}\n      </div>\n    </div>\n  </section>\n  '})}}const s={"creditCard.cardNumber":{presence:{allowEmpty:!1},format:{pattern:/^\d{13,16}$/,message:"must be a numeric value with 13 to 16 digits"}},"creditCard.exp":{presence:{allowEmpty:!1},format:{pattern:/^(0[1-9]|1[0-2])\/([0-9]{2})$/,message:"must be in the format MM/YY (e.g., 12/23)"}},"creditCard.zipCode":{presence:{allowEmpty:!1},format:{pattern:/^\d{5}$/,message:"must be a 5-digit number"}},"creditCard.cvv":{presence:{allowEmpty:!1},format:{pattern:/^\d{3,4}$/,message:"must be a 3 or 4 digit number"}},phone:{presence:{allowEmpty:!1},format:{pattern:/^\d{10}$/,message:"must be a numeric value with 10 digits"}}};class RegisterFormComponent extends AppBaseComponent{constructor(e){super(e),__publicField(this,"form"),__publicField(this,"errorSpan"),__publicField(this,"cardNumberInput"),__publicField(this,"expInput"),__publicField(this,"phoneInput"),__publicField(this,"numberOfPumps"),__publicField(this,"constraints"),this.numberOfPumps=this.state.numberOfPumps,this.constraints=s}attachEvents(){this.form=this.$("form"),this.errorSpan=this.$("#error"),this.cardNumberInput=this.$("#card-number-input"),this.expInput=this.$("#card-expiration-input"),this.phoneInput=this.$("#mobile-phone-input"),this.populatePumpDropdown(),this.preventNonNumericValues(this.form,["#card-number-input","#zipcode","#cvv-input","#mobile-phone-input"]),this.setupInputFormatting(),this.form.addEventListener("submit",(e=>this.handleSubmit(e)))}populatePumpDropdown(){const e=this.$("#pump-number");e.innerHTML="";for(let t=1;t<=this.numberOfPumps;t++){const n=document.createElement("option");n.value=t.toString(),n.textContent=`Pump ${t}`,e.appendChild(n)}}async handleSubmit(e){e.preventDefault(),e.stopPropagation(),this.errorSpan.textContent="";const n=this.getFormData(),r=i.validate(n,this.constraints);if(r)this.errorSpan.textContent=Object.values(r)[0][0];else try{const{phone:e,creditCard:r,...i}=n,{_id:s}=await this.apiService.registerCustomer(e,r,Object.keys(i).length?i:void 0);this.store.setState({...n,customerId:s,phone:n.phone,chosenPumpNumber:Number(this.$("#pump-number").value??0)}),this.store.transitionTo(t.IN_OTP_FORM)}catch{this.store.transitionTo(t.ERROR)}}getFormData(){return{phone:this.phoneInput.value,creditCard:{cardNumber:this.cardNumberInput.value.replace(/\s/g,""),exp:this.expInput.value,zipCode:this.$("#zipcode").value,cvv:this.$("#cvv-input").value}}}setupInputFormatting(){this.cardNumberInput.addEventListener("input",(()=>this.handleCardNumberInput())),this.expInput.addEventListener("input",(()=>this.handleExpInput()))}handleCardNumberInput(){const e=this.cardNumberInput.value.replace(/\D/g,"").slice(0,16);this.cardNumberInput.value=e.replace(/(\d{4})(?=\d)/g,"$1 ").trim()}handleExpInput(){const e=this.expInput.value.replace(/\D/g,"").slice(0,4);this.expInput.value=e.length>=3?`${e.slice(0,2)}/${e.slice(2)}`:e}}class StoreCardComponent extends AppBaseComponent{constructor(e,t={}){super(e),__publicField(this,"card"),this.storeData=t}templateData(){var e,t,n,r,i,s,o,a,l,u,c;return{...this.storeData,streetAddress:(null==(t=null==(e=this.storeData)?void 0:e.address)?void 0:t.streetAddress)||"unkown street",city:(null==(r=null==(n=this.storeData)?void 0:n.address)?void 0:r.city)||"unkown city",stateCode:(null==(s=null==(i=this.storeData)?void 0:i.address)?void 0:s.stateCode)||"unkown state",latitude:(null==(a=null==(o=this.storeData)?void 0:o.geoLocation)?void 0:a.latitude)||"00",longitude:(null==(u=null==(l=this.storeData)?void 0:l.geoLocation)?void 0:u.longitude)||"00",isOnline:(null==(c=this.storeData)?void 0:c.isOnline)?"Online":"Offline"}}attachEvents(){this.card=this.$(`#id-${this.storeData.storeId}`),this.card.addEventListener("click",(()=>this.handleCardClick()))}handleCardClick(){this.store.setState({chosenStoreId:this.storeData.storeId??"",numberOfPumps:this.storeData.numberOfPumps??0});const e=new URLSearchParams(window.location.search).get("mode")||"";this.store.transitionTo("full"===e?t.REGISTER_EXTENDED_FORM:t.REGISTER_FORM)}}class StoresComponent extends AppBaseComponent{constructor(e){super(e),__publicField(this,"stores",[]),__publicField(this,"cardsComponents",[]),this.stores=this.state.stores,this.cardsComponents=this.stores.map((e=>new StoreCardComponent(this.store,e)))}getStoreCards(){return this.cardsComponents.map((e=>e.render())).join("")}templateData(){return{stores:this.getStoreCards()}}attachEvents(){this.cardsComponents.forEach((e=>{e.attachEvents()}))}}class RegisterExtendedFormComponent extends RegisterFormComponent{constructor(e){super(e),__publicField(this,"firstNameInput"),__publicField(this,"lastNameInput"),__publicField(this,"emailInput"),__publicField(this,"passwordInput"),__publicField(this,"pinCodeInput"),this.constraints=s}attachEvents(){super.attachEvents(),this.firstNameInput=this.$("#first-name"),this.lastNameInput=this.$("#last-name"),this.emailInput=this.$("#email"),this.passwordInput=this.$("#password"),this.pinCodeInput=this.$("#pin-code"),this.preventNonNumericValues(this.form,["#pin-code"])}getFormData(){return{...super.getFormData(),firstName:this.firstNameInput.value.trim(),lastName:this.lastNameInput.value.trim(),email:this.emailInput.value.trim(),password:this.passwordInput.value,pinCode:this.pinCodeInput.value}}}class OtpFormComponent extends AppBaseComponent{constructor(){super(...arguments),__publicField(this,"inputs"),__publicField(this,"errorSpan"),__publicField(this,"form")}attachEvents(){this.inputs=this.$_all('input[name^="otp"]'),this.errorSpan=this.$("#error"),this.form=this.$("form"),this.inputs.forEach(((e,t)=>{e.addEventListener("input",(()=>this.handleInput(e,t))),e.addEventListener("keydown",(e=>this.handleBackspace(e,t))),e.addEventListener("paste",(e=>this.handlePaste(e)))})),this.form.addEventListener("submit",(e=>this.handleSubmit(e)))}handleInput(e,t){e.value=e.value.slice(0,1);const n=this.inputs[t+1];e.value&&n&&n.focus()}handleBackspace(e,t){const n=e.target;if("Backspace"===e.key){if(""===n.value){const e=this.inputs[t-1];e&&e.focus()}else n.value="";e.preventDefault()}}handlePaste(e){var t;e.preventDefault();const n=((null==(t=e.clipboardData)?void 0:t.getData("text"))||"").replace(/\D/g,"").split("");n.length===this.inputs.length&&this.inputs.forEach(((e,t)=>e.value=n[t]||""))}async handleSubmit(e){e.preventDefault(),this.errorSpan.innerHTML="";const n=this.getFormData();if(n.length===this.inputs.length)try{await this.apiService.verifySmsToken(this.state.customerId,n,{position:this.state.position,storeId:this.state.chosenStoreId,pumpNumber:this.state.chosenPumpNumber}),this.store.transitionTo(t.FINAL)}catch{this.store.transitionTo(t.ERROR)}else this.errorSpan.innerHTML="OTP must be 6 digits"}getFormData(){return Array.from(this.inputs).map((e=>e.value)).join("")}}class CanceledComponent extends BaseComponent{constructor(e,t){super(e),__publicField(this,"message"),this.message=t}templateData(){return{message:this.message}}}class ErrorComponent extends CanceledComponent{buildTemplatePath(){return"./canceled/canceled.template.html"}}class FinalComponent extends AppBaseComponent{}class Renderer{constructor(e){__publicField(this,"appElement"),__publicField(this,"currentComponent",null),__publicField(this,"messages",{cancel:"Please see an attendant inside to pay for fuel",error:"Something went wrong, please see an attendant inside to pay for fuel"}),this.componentFactory=e,this.appElement=document.getElementById("app")}update(e,t){this.appElement&&(this.currentComponent=this.componentFactory(e.state,t),this.appElement.innerHTML=this.currentComponent.render(),this.currentComponent.attachEvents())}}class Store{constructor(e,t,n,r){__publicField(this,"subscriber",null),__publicField(this,"OTP_COOKIE_KEY","otpState"),__publicField(this,"storeCookieState"),__publicField(this,"deleteCookieState"),__publicField(this,"excludeFromCookie"),__publicField(this,"initialState"),__publicField(this,"state"),this.initialState=e,this.state=this.initialState,this.storeCookieState=t,this.deleteCookieState=n,this.excludeFromCookie=r,this.loadStoredState()}getState(){return this.state}setState(e){this.state={...this.state,...e}}transitionTo(e){this.state.state=e,e===this.storeCookieState?this.storeOtpState():e===this.deleteCookieState&&this.deleteStoredState(),this.notifySubscriber()}storeOtpState(){const e=(t=this.state,n=this.excludeFromCookie,Object.fromEntries(Object.entries(t).filter((([e])=>!n.includes(e)))));var t,n;const r="https:"===window.location.protocol;document.cookie=`${this.OTP_COOKIE_KEY}=${encodeURIComponent(JSON.stringify(e))};path=/;max-age=120${r?";secure":""}`}subscribe(e){this.subscriber=e}notifySubscriber(){this.subscriber&&this.subscriber.update(this.state,this)}setInitialState(){this.setState(this.initialState)}loadStoredState(){const e=this.getCookie(this.OTP_COOKIE_KEY);if(e)try{const t=JSON.parse(decodeURIComponent(e));this.state={...this.initialState,...t},this.notifySubscriber()}catch{this.state=this.initialState}}deleteStoredState(){document.cookie=`${this.OTP_COOKIE_KEY}=;path=/;max-age=0;`}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?t[2]:null}}const o={state:t.INITIAL,position:{longitude:"",latitude:""},stores:[],chosenStoreId:"",numberOfPumps:0,chosenPumpNumber:0,creditCard:{cardNumber:"",exp:"",zipCode:"",cvv:""},phone:"",customerId:""};window.addEventListener("load",(async function(){const e=new ApiService,n=new Store(o,t.IN_OTP_FORM,t.FINAL,["creditCard","stores"]),r=new Renderer(function(){const e={[t.INITIAL]:e=>new InitialComponent(e),[t.REGISTER_FORM]:e=>new RegisterFormComponent(e),[t.STORES_PAGE]:e=>new StoresComponent(e),[t.REGISTER_EXTENDED_FORM]:e=>new RegisterExtendedFormComponent(e),[t.IN_OTP_FORM]:e=>new OtpFormComponent(e),[t.ERROR]:e=>new ErrorComponent(e,"Something went wrong, please see an attendant inside to pay for fuel"),[t.FINAL]:e=>new FinalComponent(e)};return(n,r)=>e[n]?e[n](r):e[t.ERROR](r)}());n.subscribe(r);const i=n.getState().state;if(i===t.INITIAL)try{navigator.geolocation.getCurrentPosition((async function(r){n.setState({position:{longitude:`${r.coords.longitude}`,latitude:`${r.coords.latitude}`}}),n.transitionTo(t.INITIAL);const{data:i}=await e.listStores(n.getState().position);n.setState({stores:i??[]}),n.transitionTo(t.STORES_PAGE)}),(async function(){n.setState({position:{longitude:"28.186879730583183",latitude:"-82.40479285767222"}}),n.transitionTo(t.INITIAL);const{data:r}=await e.listStores(n.getState().position);n.setState({stores:r??[]}),n.transitionTo(t.STORES_PAGE)}))}catch(s){n.transitionTo(t.ERROR)}else n.transitionTo(i)}));
